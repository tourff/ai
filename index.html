<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voice ChatGPT Pro</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { font-family: "Inter", sans-serif; }
#chat { scrollbar-width: thin; scrollbar-color: #888 transparent; }
#chat::-webkit-scrollbar { width: 8px; }
#chat::-webkit-scrollbar-thumb { background-color: #888; border-radius: 4px; }
</style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 flex flex-col items-center justify-center min-h-screen">

<div class="w-full max-w-md h-[90vh] bg-white dark:bg-gray-800 rounded-xl shadow-lg flex flex-col">
  
  <!-- Header -->
  <div class="p-4 border-b dark:border-gray-700 flex justify-between items-center">
    <h1 class="text-lg font-bold text-gray-800 dark:text-gray-100">Voice ChatGPT Pro</h1>
    <div class="flex space-x-2">
      <button id="toggleDark" class="px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded">🌙/☀️</button>
      <button id="resetChat" class="px-2 py-1 bg-red-400 text-white rounded">🗑️ Reset</button>
    </div>
  </div>

  <!-- Chat window -->
  <div id="chat" class="flex-1 overflow-y-auto p-4 space-y-2"></div>

  <!-- Input & voice controls -->
  <div class="p-4 border-t dark:border-gray-700 flex flex-col space-y-2">
    <div class="flex space-x-2">
      <button id="startBtn" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">🎤 Start</button>
      <button id="stopBtn" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">⏹️ Stop</button>
    </div>
    <div class="flex space-x-2 items-center">
      <label class="text-gray-700 dark:text-gray-200">Pitch:</label>
      <input id="voicePitch" type="range" min="0.5" max="2" step="0.1" value="1" class="flex-1">
      <label class="text-gray-700 dark:text-gray-200">Speed:</label>
      <input id="voiceRate" type="range" min="0.5" max="2" step="0.1" value="1" class="flex-1">
    </div>
  </div>
</div>

<script>
const chat = document.getElementById('chat');
const toggleBtn = document.getElementById('toggleDark');
const resetBtn = document.getElementById('resetChat');
const pitchInput = document.getElementById('voicePitch');
const rateInput = document.getElementById('voiceRate');

toggleBtn.onclick = () => document.body.classList.toggle('dark');
resetBtn.onclick = () => chat.innerHTML = '';

let recognition;
if ('webkitSpeechRecognition' in window) {
  recognition = new webkitSpeechRecognition();
} else { alert("Browser does not support Speech Recognition"); }

recognition.continuous = true;
recognition.interimResults = false;
recognition.lang = "en-US";

recognition.onresult = async (event) => {
  const transcript = event.results[event.results.length -1][0].transcript.trim();

  // User bubble
  const userDiv = document.createElement('div');
  userDiv.className = "flex justify-end";
  userDiv.innerHTML = `<div class="bg-blue-600 text-white px-4 py-2 rounded-lg max-w-[75%]">${transcript} 😎</div>`;
  chat.appendChild(userDiv);
  chat.scrollTop = chat.scrollHeight;

  // Send to backend
  const res = await fetch('/api/chat', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({message: transcript})
  });
  const data = await res.json();

  // AI bubble
  const aiDiv = document.createElement('div');
  aiDiv.className = "flex justify-start";
  aiDiv.innerHTML = `<div class="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 px-4 py-2 rounded-lg max-w-[75%]">🤖 ${data.response}</div>`;
  chat.appendChild(aiDiv);
  chat.scrollTop = chat.scrollHeight;

  // Voice output with pitch & rate
  const utter = new SpeechSynthesisUtterance(data.response);
  utter.lang = "en-US";
  utter.pitch = parseFloat(pitchInput.value);
  utter.rate = parseFloat(rateInput.value);
  speechSynthesis.speak(utter);

  // Optional sound effect
  const audio = new Audio('https://www.soundjay.com/button/sounds/button-16.mp3');
  audio.play();
};

// Voice buttons
document.getElementById('startBtn').onclick = () => recognition.start();
document.getElementById('stopBtn').onclick = () => recognition.stop();
</script>

</body>
</html>
